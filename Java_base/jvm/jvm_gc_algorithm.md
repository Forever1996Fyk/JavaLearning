## JVM垃圾回收算法

垃圾回收算法是垃圾回收器的核心部分, 理解其中的算法原理, 才能学习后面的各种垃圾回收器。

### 1. 垃圾标记阶段

在堆中存放的几乎都是Java对象的实例, 在GC执行垃圾回收前, 首先需要区分出内存中哪些是垃圾, 并进行标记。这个过程称为垃圾标记阶段。

**我们知道判断是否是垃圾? 简单来说, 就是一个对象已经不再被任何存活对象继续引用。**

判断对象存活的两种方式:

- 引用计数法(Reference Count)

- 可达性分析算法/根搜索方法(Root Searching)

#### 1.1 引用计数法(Java没有采用)

**引用计数法**是比较简单的方法, 对每个对象保存一个整型的引用计数器, 用于记录对象被引用的情况。

对于一个对象A, 只要有任何一个对象引用了A, 则A的计数器就加1; 当引用失效时, 引用计数器就减1.只要对象A的引用计数器的值为0, 即表示对象A不可能再被使用, 可进行回收。

优点: 

- 实现方式简单, 垃圾对象容易辨识; 

缺点:

- 需要单独的字段存储计数器, 增加了存储空间的开销;

- **无法处理循环引用问题。这也是Java没有采用的原因!!!**

循环引用导致内存泄露问题:

![jvm_reference_count](/image/jvm_reference_count.png)